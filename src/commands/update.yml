description: >
  This command migrates database changes with the Liquibase update command.

parameters:
  changelogFile:
    type: string
    default: "changelog.xml"
    description: "changelog file"

  url:
    type: env_var_name
    default: LIQUIBASE_COMMAND_URL
    # default: "jdbc:h2:file:./h2tutorial"
    description: "JDBC url to database endpoint"

  username:
    type: env_var_name
    default: LIQUIBASE_COMMAND_USERNAME
    description: "Database username"

  password:
    type: env_var_name
    default: LIQUIBASE_COMMAND_PASSWORD
    description: "Database password"

  liquibaseProLicenseKey:
    type: env_var_name
    default: LIQUIBASE_PRO_LICENSE_KEY
    description: "Liquibase License Key"

  arguments:
    description: If you wish to pass any additional arguments to the aws deploy command
    type: string
    default: ''

steps:
  - run:
      environment:
        PARAM_CHANGELOG: <<parameters.changelogFile>>
        PARAM_URL: ${<<parameters.url>>}
        PARAM_USERNAME: ${<<parameters.username>>}
        PARAM_PASSWORD: ${<<parameters.password>>}
        LIQUIBASE_PRO_LICENSE_KEY: ${<< parameters.liquibaseProLicenseKey >>}
        LB_ARGS: << parameters.arguments >>
      name: Update database with new changes
      command: <<include(scripts/update_database.sh)>>
